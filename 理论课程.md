# 理论课程

## Cache

### 术语

![Cache结构示意图](/img/理论课程/Cache结构示意图.jpg)

#### 数据块(block)

Cache与主存的基本划分单位，  
也是**主存与Cache**一次交换数据的最小单位，  
由多个字节（字）组成，  
取决于主存一次读写操作所能完成的数据字节数，  
也表明主存与Cache之间局部总线的宽度。

#### 标记(tag)
  
用来保存该Cache数据块对应的主存数据块的**地址信息**。

#### 有效位(valid bit)

Cache 中每一行有一个有效位，用于指示相应数据块中是否包含有效数据。

#### 行(line)

Cache中一个block及其tag、valid bit构成1行。

#### 组(set)

若干块(Block) 构成一个组，地址比较一般能在组内各块间同时进行。

#### 路(way)

Cache 相关联的等级，每一路具有独立的地址比较机构，各路地址比较能同时进行（一般与组结合），路数即指一组内的块数。

#### 命中率(hit rate)

目标数据在Cache中的存储访问的比例。

#### 缺失率(miss rate)

目标数据不在Cache中的存储访问的比例。

### 直接映射

[Cache直接映射视频讲解](https://www.bilibili.com/video/BV1XT4y1G7po/?spm_id_from=333.788.videocard.0)

主存的地址格式可以表示为：

|区地址tag|区内块地址index|块内字节偏移offset|

只做简要说明：

1. 把一个Cache视为一个“区”，主存可视为数个连续的区

2. 主存中“每一行”，一般每行就是一个block，都有自己的地址，这个地址是不需要存储的，原因可以参照Mux通过select bit选取输入。

3. 同样地，Cache中，每一行也有自己的地址，这个也是不用存储的，这个就是index。

4. 一个Cache中的block存储主存里block，应当能够表示主存中该block的地址。

5. Cache内index相当于自带的，所以额外存储tag即可表示自己对应的主存中块的地址。

#### 优缺点

优点

实现简单  
只需利用主存地址中的区地址，  
与（区内）块地址对应的Cache块中Tag进行1次比较，  
即可确定是否命中。

缺点

映射关系不灵活  
因每个主存块只能固定地对应某个确定的Cache块，  
会出现 Cache有很多空闲，但新块不能直接写入而需要替换的现象，  
Cache 空间的利用不充分
